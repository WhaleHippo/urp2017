<!DOCTYPE html>
<meta charset="utf-8">
<title>Visulization.html</title>
<body>

<svg width="1000" height="500"></svg>
<div id = "debug_div">debug result</div>
<button onclick="debugFunction()">debug</button>

</body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
<!--<script src="d3/firebase.js"></script>-->
<script src="https://www.gstatic.com/firebasejs/4.1.1/firebase.js"></script>

<!--
<script src = "d3/test.js"> </script>
-->

<script>
var config = {
    apiKey: "AIzaSyDMt31NS9QxSP8qPkVZjA2nCtDCn8-BpmM",
    authDomain: "firetest-d88ea.firebaseapp.com",
    databaseURL: "https://firetest-d88ea.firebaseio.com",
    projectId: "firetest-d88ea",
    storageBucket: "firetest-d88ea.appspot.com",
    messagingSenderId: "1027673372152"
};
firebase.initializeApp(config);

var database = firebase.database();
var i = 0;
var svg = d3.select("body").select("svg");

var networkData;

var layerData = [];
var layer = [];
var layerNum = 5; //metaData; layerData.length

var nodeData = [];
var node = [[],[],[],[],[],[],[],[],[],[],[]];

var nodeNum = [6,6,6,6]; //metaData; nodeData[i].length

var lineData = [];
init();
database.ref('/').on('value', function(snapshot){
		  networkData = snapshot.val();
		  console.log('firebase change : ');
      layerData = networkData.layer;
      nodeData = networkData.node;
      layerNum = layerData.length;
      for(var i = 0; i<nodeData.length; i++){
        nodeNum[i] = layerData[i].length;
      }
      console.log("node data 0,0 = " + nodeData[0][0])
		  update();

})


function init(){
/*			d3.select("body").selectAll("svg").
			data(va).enter().
			append("svg").
			attr("width",function(d){return d}).
			attr("height",function(d){return d}).
			style("background","red").
			attr("id", function(d,i){
				return "layer"+i
			}).
			on("click", function(d, i){
				videoElement = document.getElementById("layer10")
				alert(videoElement.getAttribute('id') + i)
			})


			svg.selectAll(".layer"+0).data(va).
					 enter().
					 append("circle").
					 attr("class", "layer"+0).
					 attr("r", function(d,i){return d}).
					 attr("cx", function(d,i){return 20}).
					 attr("cy", function(d,i){return i*50}).
					 on("click", function(d,i){
					 		var va = [0,15,15,15]
					 		console.log(i + " " + d)
					 		svg.selectAll("circle").data(va).
					 		transition().
					 		duration(200).
							attr("r", function(d){return d});

					 });
			layer[0] = svg.selectAll(".layer0");

			svg.selectAll(".layer"+1).data(va).
					 enter().
					 append("circle").
					 attr("class", "layer"+1).
					 attr("r", function(d,i){return d}).
					 attr("cx", function(d,i){return 70}).
					 attr("cy", function(d,i){return i*50}).
					 on("click", function(d,i){
					 		var va = [0,15,15,15]
					 		console.log(i + " " + d)
					 		svg.selectAll("circle").data(va).
					 		transition().
					 		duration(200).
							attr("r", function(d){return d});

					 });
			layer[1] = svg.selectAll(".layer1");

			svg.selectAll(".layer"+2).data(va).
					 enter().
					 append("circle").
					 attr("class", "layer"+2).
					 attr("r", function(d,i){return d}).
					 attr("cx", function(d,i){return 120}).
					 attr("cy", function(d,i){return i*50}).
					 on("click", function(d,i){
					 		var va = [0,15,15,15]
					 		console.log(i + " " + d)
					 		svg.selectAll("circle").data(va).
					 		transition().
					 		duration(200).
							attr("r", function(d){return d});

					 });
			layer[2] = svg.selectAll(".layer2");
*/
			var va = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
      for(var k = 0;k<layerNum;k++){
        svg.selectAll(".layer"+k).data(va).
             enter().
             append("circle").
             attr("class", "layer"+k).
             attr("r", function(d,i){return d}).
             attr("cx", function(d,i){return 20+100*k}).
             attr("cy", function(d,i){return (i+1)*50});


        layer[k] = svg.selectAll(".layer"+k);
        layer[k].on("click", function(d,i){
          console.log(this)
          console.log($(this).attr("class"));
          console.log($(this).attr("r"));

/*          svg.selectAll("."+$(this).attr("class")).data(va).
          transition().
          duration(200).
          attr("r", function(d,i){return $(this).attr("r")*Math.random()+8;});*/
        });;

      }
      va = [0,0,0,0,0,0];
      for(var j = 0; j < nodeNum.length; j++){
        for(var k = 0; k < nodeNum[j]; k++){
          svg.selectAll(".node"+j+"by"+k).data(va).
              enter().
              append("line").
              attr("class", "node"+j+"by"+k).
              attr("x1", function(d,i){return 20+100*j;}).
              attr("x2", function(d,i){return 120+100*j;}).
              attr("y1", function(d,i){return (k+1)*50;}).
              attr("y2", function(d,i){return (i+1)*50;}).
              attr("stroke", "blue").
              attr("stroke-width", function(d,i){return d+0.1});
          node[j][k] = svg.selectAll(".node"+j+"by"+k);
          node[j][k].on("click", function(){
            //alert($(this).attr("class"));
            console.log($(this).attr("stroke-width"))
          })
        }
      }

}

function debugFunction(){
  alert("!")
}

function update(){
  console.log("update!")
  for(var k =0; k < layerNum; k++){
    console.log("layer update!")
    layer[k].data(layerData[k]).
             transition().
             duration(200).
             attr("r", function(d,i){return d});
  }

  for(var j = 0; j < 4; j++){
    for(var k = 0; k < 6; k++){
      console.log("node update!")
      //console.log(nodeData[j][k])
      node[j][k].data(nodeData[j][k]).
                 transition().
                 duration(200).
                 attr("stroke", "red").
                 attr("stroke-width", function(d,i){return d}).
                 transition().
                 duration(1000).
                 attr("stroke", "blue");

    }
  }

/*  svg.selectAll(".node"+0+"by"+1).data(nodeData[0][1]).
               transition().
               duration(200).
               attr("stroke", "blue").
               attr("stroke-width", function(d,i){return d});*/
  /*node[2][2].data(nodeData[1][1]).
             transition().
             duration(200).
             attr("stroke", "blue").
             attr("stroke-width", function(d,i){return d}).
             on("click", function(d){alert(d)});*/
}




</script>
